apiVersion: build.openshift.io/v1
kind: BuildConfig
metadata:
  name: ger-build3
parameters:
- description: Name of the App
  displayName: App Name
  name: APP_NAME
- description: Uri of project
  displayName: Project Uri
  name: GIT_URL
spec:
  strategy:
    type: JenkinsPipeline
    jenkinsPipelineStrategy:
      jenkinsfile: |-
        node {
          stage('delete prev ver') {
            sh 'oc delete all --selector app=' + ${APP_NAME}
            sh 'oc delete all --selector application=' + ${APP_NAME}
          }
          stage('ImageStream') {
            dir('app') {
              sh 'oc new-app -f https://raw.githubusercontent.com/gditrani269/s2i-dotnetcore-ex/master/openshift/ImageStream.yaml'
            }
          }
          stage('BuildConfig') {
            dir('app') {
              sh 'oc new-app -f https://raw.githubusercontent.com/gditrani269/s2i-dotnetcore-ex/master/openshift/BuildConfig.yaml'
              sh 'sleep 8'
              sh 'oc logs -f bc/ger'
            }
          }
          stage('DeploymentConfig') {
            dir('app') {
              sh 'oc new-app -f https://raw.githubusercontent.com/gditrani269/s2i-dotnetcore-ex/master/openshift/DeploymentConfig.yaml'
              sh 'sleep 10'
              sh 'oc logs dc/ger'
            }
          }
          stage('Service') {
            dir('app') {
              sh 'oc new-app -f https://raw.githubusercontent.com/gditrani269/s2i-dotnetcore-ex/master/openshift/Service.yaml'
              sh 'sleep 8'
              sh 'oc logs svc/ger'
            }
          }
          stage('Route') {
            dir('app') {
              sh 'oc new-app -f https://raw.githubusercontent.com/gditrani269/s2i-dotnetcore-ex/master/openshift/Route.yaml'
              sh 'sleep 8'
              sh 'oc describe route/ger'
            }
          }
        }
